---

    - name: Installing Python packages
      include_role:
        name: python-install
      vars:
        github_user: "{{item.github_user}}"
        github_repo: "{{item.github_repo}}"
        pip_package: "{{item.pip_package}}"
        conda_package: "{{item.conda_package}}"
      with_items:
          - { github_user: "proycon", github_repo: "pynlpl", pip_package: "pynlpl", conda_package: "" }
          - { github_user: "proycon", github_repo: "clam", pip_package: "clam", conda_package: "" }
          - { github_user: "proycon", github_repo: "folia", pip_package: "folia-tools", conda_package: "" }
          - { github_user: "proycon", github_repo: "babelpy", pip_package: "babelpy", conda_package: "" }
          - { github_user: "proycon", github_repo: "babelente", pip_package: "babelente", conda_package: "" }

    - block:
        - name: Testing Python packages
          include_role:
              name: lamachine_run
          vars:
              command: "python -c 'import {{ item }}'"
          with_items:
              - pynlpl
              - pynlpl.formats.folia
          register: test
          changed_when: test.rc != 0
      rescue:
        - name: "Package list at time of failure"
          shell: "{{local_prefix}}/bin/conda -p {{local_prefix}} list"
          when: localenv_type == "conda" and not prefer_global

    - block:
        - name: Testing whether python-based tools start
          include_role:
              name: lamachine_run
          vars:
              command: "{{ item }} -h"
          with_items:
              - foliavalidator
              - clamservice
              - folia2html
              - folia2txt
              - foliaquery
              - babelente
          register: test
          changed_when: test.rc != 0
      rescue:
        - name: "Package list at time of failure"
          shell: "{{local_prefix}}/bin/conda -p {{local_prefix}} list"
          when: localenv_type == "conda" and not prefer_global

